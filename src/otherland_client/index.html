<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Otherland Network</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="/src/index.scss">
</head>

<body>

    <!-- Start Screen -->
    <div id="start-screen">
        <H1>Otherland</H1>
        <h3>Connected virtual realms on the Internet Computer.</h3>
        <button id="connect-ii-btn">Connect to Internet Identity</button>
        <button id="continue-guest-btn">Continue as Guest</button>
    </div>

    <!-- Main Menu -->
    <div id="main-menu">
        <div id="side-bar">
            <h1>Otherland</h1>
            <div id="side-bar-buttons">
                <button id="otherland-btn">Otherland</button>
                <button id="treehouse-btn">TreeHouse</button>
                <button id="store-btn">Store</button>
                <button id="wallet-btn">Wallet</button>
                <button id="settings-btn">Settings</button>
            </div>
        </div>
        <div id="tab-content">

            <!-- Otherland Nodes -->
            <div id="otherland-tab" class="tab future-update">
                <h1>Network</h1>
                <div id="node-list">
                    <table id="node-table">
                        <tr>
                            <th><p>Node ID</p></th>
                            <th><p>Owner</p></th>
                        </tr>
                    </table>
                </div>
                <div id="node-buttons">
                    <button id="cardinal-connect-btn">Connect to Cardinal Node</button>
                    <button id="request-new-canister">Request New Canister</button>
                    <button id="enter-node-btn">Enter Node</button>
                    <button id="edit-node-btn">Edit Environment</button>
                    <button id="node-settings-btn">Settings</button>
                </div>
            </div>

            <!-- TreeHouse -->
            <div id="treehouse-tab" class="tab">
                <h1>TreeHouse</h1>

                <button id="enter-treehouse-btn">Enter TreeHouse</button>

                <button id="edit-treehouse-btn">Edit Environment</button>
                <button id="node-config-btn">Settings</button>

                <!-- Peer to Peer -->
                <div class="flex-row">
                    <h2>Play with friends</h2>
                    <button id="toggle-p2p-btn">Off</button>
                </div>
                <div id="peer-info">
                    <!-- Player ID -->
                    <p id="user-id-title">Generating Peer ID ...</p>

                    <div class="flex-row">
                        <!-- Sharing -->
                        <button id="share-th-link-btn">Invite Player</button>
    
                        <!-- Reset Peer -->
                        <button id="reset-p2p-btn">Disconnect & Reset Peer ID</button>
                    </div>
                </div>

                <!-- Join Friends TreeHouses -->
                <div id="quick-connect-invitation">
                    <div>
                        <p>Invitation to TreeHouse detected: </p>
                        <button id="join-quick-connect"></button>
                    </div>
                    <!-- List all past Connections, store principal for future connections -->
                </div>
            </div>

            <!-- Asset Manager -->
            <div id="assets-tab" class="tab">
                <h1 id="assets-title">Assets</h1>
                <h3>List of Avatars</h3>

                <!-- List of all Khets in Node -->
                <h3>List of Objects in Node</h3>
                <div id="khet-list">
                    <table id="khet-table">
                        <tr>
                            <th><p>Object ID</p></th>
                            <th><p>Type</p></th>
                            <th><p>Position</p></th>
                            <th><p>Scale</p></th>
                            <th><p>Code</p></th>
                        </tr>
                    </table>
                </div>

                <!-- Clear Khets -->
                <button id="clear-khets-btn">Delete All Objects</button>
        
                <!-- Khet Editor -->
                <div id="khet-editor">
                    <div id="draw-up-btn"><button>ðŸ¡©</button></div>
                    <div id="draw-close-btn"><button>ðŸ—™</button></div>
                    <div id="upload-group">
                        <h3>Upload Object</h3>
                        <input type="file" id="upload-khet" accept=".glb" multiple>
                        <div class="flex-row">
                            <select id="khet-type">
                                <option value="SceneObject">Scene Object</option>
                                <option value="InteractiveObject">Interactive Object</option>
                                <option value="MobileObject">Mobile Object</option>
                                <option value="Entity">Entity</option>
                                <option value="Avatar">Avatar</option>
                            </select>
                            <button id="upload-btn">Upload to Node</button>
                            <button id="cache-btn">Store to Cache</button>
                        </div>
                    </div>
                    <div id="edit-group">
                        <h3>Edit Object</h3>
                        <p>Type: <span id="edit-khet-type"></span></p>
                        <p>ID: <span id="edit-khet-id"></span></p>
                        <button id="discard-edit-btn">Discard Changes</button>
                        <button id="save-edit-btn">Save & Close</button>
                    </div>
                    <div class="input-group">
                        <label>Position (x, y, z):</label>
                        <div>
                            <input type="number" id="pos-x" placeholder="X" step="0.1">
                            <input type="number" id="pos-y" placeholder="Y" step="0.1">
                            <input type="number" id="pos-z" placeholder="Z" step="0.1">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label>Scale (x, y, z):</label>
                        <div>
                            <input type="number" id="scale-x" placeholder="X" step="0.1" value="1">
                            <input type="number" id="scale-y" placeholder="Y" step="0.1" value="1">
                            <input type="number" id="scale-z" placeholder="Z" step="0.1" value="1">
                        </div>
                    </div> 
                </div>
            </div>
            <div id="store-tab" class="tab future-update">
                <h1>Store</h1>
                <div>Ad space</div>
                <div>Portals</div>
                <div>Khet Objects</div>
                <div>Avatars</div>
                <div>NFTs</div>
            </div>
            <div id="wallet-tab" class="tab future-update">
                <h1>Wallet</h1>
                <div>Balance & Report</div>
                <div>Spending Manager</div>
                <div>Buy Cycles with ICP/BTC/ETC/SOL/DOGE/Credit card</div>
                <div>NFT storage</div>
            </div>
            <div id="settings-tab" class="tab future-update">
                <h1>Settings</h1>
                <input id="wasm-pw" type="text" placeholder="Password">
                <input type="file" id="wasm-file-input" accept=".wasm" />
                <!-- Placeholder -->
            </div>
        </div>
    </div>

    <!-- Game Menu -->
    <div id="game-menu">
        <h1>Otherland Network</h1>

        <!-- Main Menu Buttons -->
        <div id="main-page" class="page active">
            <button id="home-btn">Home</button>
            <button id="avatar-btn">Avatar</button>
            <button id="game-settings-btn">Settings</button>
            <button id="close-btn">Resume</button>
        </div>

        <!-- Settings Page -->
        <div id="settings-page" class="page">
            <h2>Settings</h2>
            <label><input type="checkbox" id="toggle-chat" checked> Show Chat</label><br>
            <label><input type="checkbox" id="toggle-friends" checked> Friends List</label><br>
            <label><input type="checkbox" id="toggle-map" checked> Show Map</label><br>
            <button id="back-settings-btn">Back</button>
        </div>

        <!-- Avatar Page -->
        <div id="avatar-page" class="page">
            <h2>Select Avatar</h2>
            <div id="avatar-container"></div>
            <button id="back-avatar-btn">Back</button>
        </div>
    </div>

    <!-- Info Box -->
    <div id="info-box">

        <!-- Account Switcher (Top Right) -->
        <div id="account-switcher">
            <!-- Populated dynamically -->
        </div>

        <!-- User ID -->
        <div id="node-state">
            <div id="node-info"></div>
            <div id="conn-info"></div>
            <div id="status-info"></div>
        </div>

        <!-- Download Progress Bar -->
        <div id="download-container">
            <div id="download-bar">Downloading Node Data</div>
        </div>

        <!-- Upload Progress Bar -->
        <div id="upload-container">
            <div id="upload-bar">Uploading Asset Data</div>
        </div>
    </div>

    <!-- GUI Areas -->
    <div id="guiLayer">
        <div id="guiCenter">
            <div id="crosshairs"></div>
        </div>
        <div id="guiTop">
            <div id="friends-list">Friends List</div>
        </div>
        <div id="guiBottom">

            <!-- Chat Window --> 
            <div id="chat">
                <h3>Group Chat</h3>
                <div id="chat-messages"></div>
                <input type="text" id="chat-input" placeholder="Type a message...">
                <button id="send-chat-btn">Send</button>
            </div>

            <!-- Interaction Hint popup -->
            <div id="interactionHint">No interaction detected</div>

            <!-- Map Window -->
            <div id="map">Map Area</div>
        </div>
        <div id="guiTags">
            <div id="nameTags"></div>
        </div>
    </div>

    <!-- 2D Viewer -->
    <canvas id="canvas"></canvas>

    <!-- Controls for Mobile Devices -->
    <div id="mobile-controls">

        <!-- Joystick container for movement -->
        <div id="joystick-zone"></div>
    
        <!-- Jump button -->
        <button id="jump-btn">Jump</button>
    
        <!-- Sprint button -->
        <button id="sprint-btn">Sprint</button>
    
        <!-- ESC button -->
        <button id="esc-btn">ESC</button>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/PointerLockControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/nipplejs@0.9.0/dist/nipplejs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cannon@0.6.2/build/cannon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.4/dist/peerjs.min.js"></script>
    <script type="module" src="/src/index.js"></script>
</body>
</html>